
(function($){tableform={buttons_render:function(buttons,notoolbar){var b="";if(!notoolbar){b+="<div class=\"asm-toolbar\">";}
$.each(buttons,function(i,v){if(v.hideif&&v.hideif()){return;}
if(!v.type||v.type=="button"){b+="<button id=\"button-"+v.id+"\" title=\""+html.title(v.tooltip)+"\">"+html.icon(v.icon);if(v.text){b+=" "+v.text;}
b+="</button>";}
else if(v.type=="raw"){b+=v.markup;}
else if(v.type=="dropdownfilter"){b+='<span style="float: right"><select id="'+v.id+'" title="'+html.title(v.tooltip)+'" class="asm-selectbox">';if(common.is_array(v.options)){$.each(v.options,function(io,vo){var opt=vo.split("|");var val,label;val=opt[0];if(opt.length>1){label=opt[1];}
else{label=opt[0];}
b+='<option value="'+val+'">'+label+'</option>';});}
else{b+=v.options;}
b+='</select></span>';}
else if(v.type=="buttonmenu"){b+='<span id="button-'+v.id+'" class="asm-menu-icon" title="'+html.title(v.tooltip)+'">'+html.icon(v.icon);if(v.text){b+=" "+v.text;}
b+='</span>';if(v.options){var menu='<div id="button-'+v.id+'-body" class="asm-menu-body"><ul class="asm-menu-list">';$.each(v.options,function(io,vo){var opt=vo.split("|");var val,label;val=opt[0];if(opt.length>1){label=opt[1];}
else{label=opt[0];}
menu+='<li class="asm-menu-item"><a href="#" data="'+val+'">'+label+'</a></li>';});menu+='</ul></div>';$("body").prepend(menu);}}
b+=" ";});if(!notoolbar){b+="</div>";}
return b;},buttons_bind:function(buttons){$.each(buttons,function(i,v){if(!v.type||v.type=="button"){$("#button-"+v.id).button();if(v.click){$("#button-"+v.id).click(v.click);}
if(v.mouseover){$("#button-"+v.id).mouseover(v.mouseover);}
if(v.mouseleave){$("#button-"+v.id).mouseleave(v.mouseleave);}
if(v.enabled!="always"){$("#button-"+v.id).button("disable");}}
else if(v.type=="buttonmenu"){$("#button-"+v.id).asmmenu();$("#button-"+v.id+"-body a").each(function(){if(v.click){var dataval=$(this).attr("data");$(this).click(function(){v.click(dataval);return false;});}});if(v.enabled!="always"){$("#button-"+v.id).addClass("ui-state-disabled").addClass("ui-button-disabled");}}
else if(v.type=="dropdownfilter"){$("#"+v.id).change(function(){if(v.click){v.click($("#"+v.id).val());}});}});},buttons_default_state:function(buttons){$.each(buttons,function(i,v){if(!v.type||v.type=="button"){$("#button-"+v.id).button("enable");if(v.enabled!="always"){$("#button-"+v.id).button("disable");}}
else if(v.type=="buttonmenu"){if(v.enabled!="always"){$("#button-"+v.id).addClass("ui-state-disabled").addClass("ui-button-disabled");}}});},format_currency:function(row,v){return format.currency(v);},format_date:function(row,v){return format.date(v);},format_datetime:function(row,v){return format.date(v)+" "+format.time(v);},format_string:function(row,v){if(!v){return"";}
return String(v);},table_render:function(table,bodyonly){var t=[];if(!bodyonly){t.push("<table id=\"tableform\" width=\"100%\"><thead><tr>");$.each(table.columns,function(i,v){if(v.hideif&&v.hideif()){return;}
t.push("<th>"+v.display+"</th>");});t.push("</tr><thead><tbody>");}
$.each(table.rows,function(ir,vr){if(table.hideif&&table.hideif(vr)){return;}
var rowid=vr[table.idcolumn];t.push("<tr id=\"row-"+rowid+"\">");$.each(table.columns,function(ic,vc){var formatter=vc.formatter;if(vc.hideif&&vc.hideif(vr)){return;}
var extraclasses="";if(table.complete){if(table.complete(vr)){extraclasses+=" asm-completerow";}}
if(table.overdue){if(table.overdue(vr)){extraclasses+=" asm-overduerow";}}
t.push("<td class=\"ui-widget-content "+extraclasses+"\">");if(ic==0&&formatter===undefined){t.push("<span style=\"white-space: nowrap\">");t.push("<input type=\"checkbox\" data-id=\""+rowid+"\" title=\""+html.title(_("Select"))+"\" />");t.push("<a href=\"#\" class=\"link-edit\" data-id=\""+rowid+"\">"+tableform.format_string(vr,vr[vc.field])+"</a>");t.push("</span>");}
else{if(formatter===undefined){formatter=tableform.format_string;}
t.push(formatter(vr,vr[vc.field]));}
t.push("</td>");});t.push("</tr>");});if(!bodyonly){t.push("</tbody></table>");}
return t.join("\n");},table_update:function(table){$("#tableform tbody").empty();$("#tableform tbody").html(this.table_render(table,true));if($("#tableform").prop("data-style-td")){$("#tableform td").addClass("ui-widget-content");}
$("#tableform").trigger("update");this.table_apply_sort(table);},table_bind:function(table,buttons){if(table.edit){$("#tableform").on("click","a",function(){var anchor=$(this);var iseditlink=false;$.each(table.rows,function(i,v){if(v[table.idcolumn]==anchor.attr("data-id")){iseditlink=true;table.edit(v);}});if(iseditlink){return false;}});}
if(buttons){$("#tableform").on("click","input[type='checkbox']",function(){var nosel=$("#tableform input:checked").length;$.each(buttons,function(i,b){var bn=$("#button-"+b.id),enabled=false;if(b.enabled=="always"){enabled=true;}
if(b.enabled=="multi"&&nosel>0){enabled=true;}
if(b.enabled=="one"&&nosel==1){enabled=true;}
if(enabled){if(!b.type||b.type=="button"){bn.button("enable");}
else if(b.type=="buttonmenu"){$("#button-"+b.id).removeClass("ui-state-disabled").removeClass("ui-button-disabled");}}
else{if(!b.type||b.type=="button"){bn.button("disable");}
else if(b.type=="buttonmenu"){bn.addClass("ui-state-disabled").addClass("ui-button-disabled");}}});});}
$("#tableform").table();this.table_apply_sort(table);},table_apply_sort:function(table){if($("#tableform tbody tr").length==0){return;}
var sortList;var visibleIndex=0;$.each(table.columns,function(i,v){if(sortList){return;}
if(v.hideif&&v.hideif()){return;}
if(v.initialsort){var sortdir=0;if(v.initialsortdirection&&v.initialsortdirection=="desc"){sortdir=1;}
sortList=[[visibleIndex,sortdir]];return;}
visibleIndex+=1;});$("#tableform").trigger("sorton",[sortList]);},table_ids:function(table){var s="";$("#tableform input:checked").each(function(){s+=$(this).attr("data-id")+",";});return s;},table_selected_row:function(table){var result,selid=$("#tableform input:checked").attr("data-id");if(!selid){return undefined;}
$.each(table.rows,function(i,v){if(v[table.idcolumn]==selid){result=v;}});return result;},table_selected_rows:function(table){var results=[],selid=$("#tableform input:checked").attr("data-id");$("#tableform input:checked").each(function(){var el=$(this);$.each(table.rows,function(i,v){if(v[table.idcolumn]==el.attr("data-id")){results.push(v);}});});return results;},table_id_selected:function(id){var issel=false;$("#tableform input:checked").each(function(){if($(this).attr("data-id")==id){issel=true;}});return issel;},table_remove_selected_from_json:function(table,rows){var ids=this.table_ids(table).split(",");$.each(ids,function(ix,id){$.each(rows,function(i,row){if(row&&row[table.idcolumn]==id){rows.splice(i,1);}});});},dialog_render:function(dialog){var d=[];d.push("<div id=\"dialog-tableform\" style=\"display: none\">");if(dialog.helper_text){d.push("<div id=\"dialog-tableform-help\" class=\"ui-widget\">");d.push("<div class=\"ui-state-highlight ui-corner-all\"><p>");d.push("<span class=\"ui-icon ui-icon-info\" style=\"float: left; margin-right: .3em;\"></span>");d.push("<span id=\"dialog-tableform-help-text\">"+dialog.helper_text+"</span>");d.push("</p></div></div>");}
d.push("<div id=\"dialog-tableform-error\" style=\"display: none\" class=\"ui-widget\">");d.push("<div class=\"ui-state-error ui-corner-all\"><p>");d.push("<span class=\"ui-icon ui-icon-alert\" style=\"float: left; margin-right: .3em;\"></span>");d.push("<strong><span id=\"dialog-tableform-error-text\"></span></strong>");d.push("</p></div></div>");d.push("<div id=\"dialog-tableform-info\" style=\"display: none\" class=\"ui-widget\">");d.push("<div class=\"ui-state-highlight ui-corner-all\"><p>");d.push("<span class=\"ui-icon ui-icon-info\" style=\"float: left; margin-right: .3em;\"></span>");d.push("<span id=\"dialog-tableform-info-text\"></span>");d.push("</p></div></div>");if(dialog.html_form_action){d.push("<form id=\"form-tableform\" method=\"post\" action=\""+dialog.html_form_action+"\"");if(dialog.html_form_enctype){d.push(" enctype=\""+dialog.html_form_enctype+"\"");}
d.push(">");}
if(dialog.autofocus===false){d.push(html.capture_autofocus());}
d.push(this.fields_render(dialog.fields,dialog.columns));if(dialog.html_form_action){d.push("</form>");}
d.push("</div>");return d.join("\n");},dialog_bind:function(dialog){this.fields_bind(dialog.fields);},dialog_close:function(){$("#dialog-tableform").dialog("close");$("#dialog-tableform").enable_dialog_buttons();},dialog_error:function(text){if(!text){$("#dialog-tableform-error").hide();}
else{$("#dialog-tableform-error-text").html(text);$("#dialog-tableform-error").fadeIn();}},dialog_info:function(text){if(!text){$("#dialog-tableform-info").hide();}
else{$("#dialog-tableform-info-text").html(text);$("#dialog-tableform-info").fadeIn().delay(5000).fadeOut();}},dialog_disable_buttons:function(){$("#dialog-tableform").disable_dialog_buttons();},dialog_enable_buttons:function(){$("#dialog-tableform").enable_dialog_buttons();},dialog_show_add:function(dialog,callback,onloadcallback){var b={};if(dialog.use_default_values===undefined||dialog.use_default_values===true){tableform.fields_default(dialog.fields);}
$.each(dialog.fields,function(i,v){if(v.readonly){$("#"+v.post_field).prop("disabled",false);if(dialog.hide_read_only){$("#"+v.post_field).closest("tr").show();}}});b[_("Add")]=function(){if(tableform.fields_validate(dialog.fields)){if(dialog.close_on_ok){$(this).dialog("close");}
else{$("#dialog-tableform").disable_dialog_buttons();}
callback();}};b[_("Cancel")]=function(){$(this).dialog("close");};$("#dialog-tableform").dialog({resizable:false,width:(dialog.width||"auto"),height:(dialog.height||"auto"),modal:true,dialogClass:"dialogshadow",autoOpen:false,title:dialog.add_title,show:dlgfx.add_show,hide:dlgfx.add_hide,buttons:b});this.dialog_error("");$("#dialog-tableform").dialog("open");if(onloadcallback){onloadcallback();}},dialog_show_edit:function(dialog,row,changecallback,onloadcallback){this.fields_populate_from_json(dialog.fields,row);$.each(dialog.fields,function(i,v){if(v.readonly){$("#"+v.post_field).prop("disabled",true);if(dialog.hide_read_only){$("#"+v.post_field).closest("tr").hide();}}});var b={};b[_("Change")]=function(){if(tableform.fields_validate(dialog.fields)){if(dialog.close_on_ok){$(this).dialog("close");}
else{$("#dialog-tableform").disable_dialog_buttons();}
if(changecallback){changecallback(row);}}};b[_("Cancel")]=function(){$(this).dialog("close");};$("#dialog-tableform").dialog({resizable:false,width:(dialog.width||"auto"),height:(dialog.height||"auto"),modal:true,dialogClass:"dialogshadow",autoOpen:false,title:dialog.edit_title,show:dlgfx.edit_show,hide:dlgfx.edit_hide,buttons:b});this.dialog_error("");$("#dialog-tableform").dialog("open");if(onloadcallback){onloadcallback(row);}},fields_render:function(fields,columns,dontrenderoutertable){var d="";if(columns===undefined){columns=1;}
if(!dontrenderoutertable){d="<table width=\"100%\">";}
if(columns>1){d+="<tr><td><table>";}
$.each(fields,function(i,v){if(v.hideif&&v.hideif()){return;}
if(v.type=="check"){if(!v.justwidget){d+="<tr><td></td><td>";}
d+="<input id=\""+v.post_field+"\" type=\"checkbox\" class=\"asm-checkbox\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+="/>";if(!v.justwidget){d+="<label for=\""+v.post_field+"\">"+v.label+"</label></td></tr>";}}
else if(v.type=="text"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<input id=\""+v.post_field+"\" type=\"text\" class=\"asm-textbox "+v.classes;if(v.halfsize){d+=" asm-halftextbox";}
d+="\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+="/>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="textarea"){if(!v.justwidget){if(v.labelpos&&v.labelpos=="above"){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label><br />";}
else{d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}}
if(!v.rows){v.rows=5;}
d+="<textarea id=\""+v.post_field+"\" class=\"asm-textarea "+v.classes+"\" rows=\""+v.rows+"\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+="></textarea>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="date"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<input id=\""+v.post_field+"\" type=\"text\" class=\"asm-textbox asm-datebox\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+="/>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="time"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<input id=\""+v.post_field+"\" type=\"text\" class=\"asm-textbox asm-timebox ";if(v.halfsize){d+=" asm-halftextbox";}
d+="\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+="/>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="currency"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<input id=\""+v.post_field+"\" type=\"text\" class=\"asm-textbox asm-currencybox";if(v.halfsize){d+=" asm-halftextbox";}
d+="\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+="/>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="number"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<input id=\""+v.post_field+"\" type=\"text\" class=\"asm-textbox asm-numberbox ";if(v.halfsize){d+=" asm-halftextbox";}
d+="\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+="/>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="select"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<select id=\""+v.post_field+"\" class=\"asm-selectbox";if(v.halfsize){d+=" asm-halftextbox";}
d+="\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+=">";if(common.is_array(v.options)){$.each(v.options,function(ia,va){d+="<option>"+va+"</option>";});}
else if(common.is_string(v.options)){d+=v.options;}
else if(v.options&&v.options.rows){$.each(v.options.rows,function(io,vo){d+="<option value=\""+vo[v.options.valuefield]+"\">"+vo[v.options.displayfield]+"</option>";});}
d+="</select>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="selectmulti"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<select id=\""+v.post_field+"\" multiple=\"multiple\" class=\"asm-bsmselect";if(v.halfsize){d+=" asm-halftextbox";}
d+="\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+=">";if(v.options&&v.options.rows){$.each(v.options.rows,function(io,vo){d+="<option value=\""+vo[v.options.valuefield]+"\">"+vo[v.options.displayfield]+"</option>";});}
else if(v.options){d+=v.options;}
d+="</select>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="person"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<input id=\""+v.post_field+"\" type=\"hidden\" class=\"asm-personchooser\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.personfilter){d+="data-filter=\""+v.personfilter+"\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
d+="/>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="animal"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<input id=\""+v.post_field+"\" type=\"hidden\" class=\"asm-animalchooser\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.animalfilter){d+="data-filter=\""+v.animalfilter+"\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
d+="/>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="file"){if(!v.justwidget){d+="<tr><td><label for=\""+v.post_field+"\">"+v.label+"</label></td><td>";}
d+="<input id=\""+v.post_field+"\" name=\""+v.post_field+"\" type=\"file\" ";d+="data-json=\""+v.json_field+"\" data-post=\""+v.post_field+"\" ";if(v.readonly){d+=" data-noedit=\"true\" ";}
if(v.validation){d+="data-validation=\""+v.validation+"\" ";}
if(v.tooltip){d+="title=\""+html.title(v.tooltip)+"\"";}
d+="/>";if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="raw"){if(!v.justwidget){d+="<tr id=\""+v.post_field+"\"><td><label>"+v.label+"</label></td><td>";}
d+=v.markup;if(!v.justwidget){d+="</td></tr>";}}
else if(v.type=="nextcol"){d+="</table><td><td><table>";}});if(columns>1){d+="</table></td></tr>";}
if(!dontrenderoutertable){d+="</table>";}
return d;},fields_bind:function(fields){$.each(fields,function(i,v){if(v.change){$("#"+v.post_field).change(v.change);}
if(v.blur){$("#"+v.post_field).blur(v.blur);}});},fields_default:function(fields){$.each(fields,function(i,v){if(!v.defaultval){if(v.type=="check"){$("#"+v.post_field).prop("checked",false);return;}
if(v.type=="animal"){$("#"+v.post_field).animalchooser("clear");return;}
if(v.type=="person"){$("#"+v.post_field).personchooser("clear");return;}
if(v.type=="selectmulti"){$("#"+v.post_field).children().prop("selected",false);$("#"+v.post_field).change();return;}
if(v.type=="textarea"){$("#"+v.post_field).val("");return;}
if(v.type!="select"&&v.type!="nextcol"){$("#"+v.post_field).val("");}}
else{var dval=v.defaultval;if(v.defaultval instanceof Function){dval=v.defaultval();}
if(v.defaultval instanceof Date){dval=format.date(v.defaultval);}
if(v.type=="check"){$("#"+v.post_field).prop("checked",dval);return;}
if(v.type=="animal"){$("#"+v.post_field).animalchooser("loadbyid",dval);return;}
if(v.type=="person"){$("#"+v.post_field).personchooser("loadbyid",dval);return;}
if(v.type=="select"){$("#"+v.post_field).select("value",dval);return;}
if(v.type=="textarea"){$("#"+v.post_field).val(dval);return;}
if(v.type!="nextcol"){$("#"+v.post_field).val(dval);}}});},fields_populate_from_json:function(fields,row){$.each(fields,function(i,v){var n=$("#"+v.post_field);if(n.length==0){return;}
if(v.type=="animal"){n.animalchooser("loadbyid",row[v.json_field]);}
else if(v.type=="person"){n.personchooser("loadbyid",row[v.json_field]);}
else if(v.type=="currency"){n.currency("value",row[v.json_field]);}
else if(v.type=="date"){n.val(format.date(row[v.json_field]));}
else if(v.type=="time"){n.val(format.time(row[v.json_field]));}
else if(v.type=="check"){n.prop("checked",row[v.json_field]==1);}
else if(v.type=="select"){n.select("value",row[v.json_field]);}
else if(v.type=="selectmulti"){n.children().prop("selected",false);$.each(String(row[v.json_field]).split(/[|,]+/),function(mi,mv){n.find("[value='"+mv+"']").prop("selected",true);});n.change();}
else if(v.type=="textarea"){var s=row[v.json_field];if(!s){s="";}
s=s.replace(/</g,"&lt;").replace(/>/g,"&gt;");n.val(html.decode(s));}
else{n.val(html.decode(row[v.json_field]));}});},fields_update_row:function(fields,row){$.each(fields,function(i,v){var n=$("#"+v.post_field);if(v.type=="currency"){row[v.json_field]=n.currency("value");}
else if(v.type=="date"){row[v.json_field]=format.date_iso(n.val());}
else if(v.type=="time"){row[v.json_field]=format.date_iso_settime(row[v.json_field],n.val());}
else if(v.type=="check"){row[v.json_field]=n.is(":checked")?1:0;}
else if(v.type=="selectmulti"){if(!n.val()){row[v.json_field]="";}
else if($.isArray(n.val())){row[v.json_field]=n.val().join("|");}
else{row[v.json_field]=n.val();}}
else{row[v.json_field]=n.val();}});},fields_validate:function(fields){var nbids=[];var nzids=[];$.each(fields,function(i,v){$("label[for='"+v.post_field+"']").removeClass("ui-state-error-text");if(v.validation=="notblank"){nbids.push(v.post_field);}
if(v.validation=="notzero"){nzids.push(v.post_field);}});var rv=true;if(nbids.length>0){rv=validate.notblank(nbids);if(!rv){return rv;}}
if(nzids.length>0){rv=validate.notzero(nzids);if(!rv){return rv;}}
return true;},fields_post:function(fields,postvar,postto,callback,errorcallback){var post="";if(postvar){post=postvar;}
$.each(fields,function(i,v){var n=$("#"+v.post_field);if(v.type=="check"){if(post!=""){post+="&";}
if(n.is(":checked")){post+=v.post_field+"=checked";}
else{post+=v.post_field+"=off";}}
else if(v.type!="raw"){if(post!=""){post+="&";}
var pv="";if(n.val()){pv=n.val();}
post+=v.post_field+"="+encodeURIComponent(pv);}});$.ajax({type:"POST",url:postto,data:post,dataType:"text",success:function(result){callback(result);},error:function(jqxhr,textstatus,response){var errmessage=common.get_error_response(jqxhr,response);tableform.dialog_error(errmessage);if(errorcallback){errorcallback(errmessage);}}});return post;},delete_dialog:function(callback,text){var b={};b[_("Delete")]=function(){$("#dialog-delete").dialog("close");callback();};b[_("Cancel")]=function(){$(this).dialog("close");};var mess=_("This will permanently remove the selected records, are you sure?");if(text&&text!=""){mess=text;}
if($("#dialog-delete").length==0){$("body").append('<div id="dialog-delete" style="display: none" title="'+
_("Delete")+'"><p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>'+'<span id="dialog-delete-text"></span></p></div>');}
$("#dialog-delete-text").html(mess);$("#dialog-delete").dialog({resizable:false,height:170,width:400,modal:true,dialogClass:"dialogshadow",show:dlgfx.delete_show,hide:dlgfx.delete_hide,buttons:b});}};}(jQuery));