
$(function(){var move_reserve={render:function(){return['<div id="asm-content">','<input id="movementid" type="hidden" />','<div id="page1">',html.content_header(_("Reserve an animal"),true),'<div id="ownerwarn" class="ui-state-error ui-corner-all" style="margin-top: 5px; padding: 0 .7em; width: 60%; margin-left: auto; margin-right: auto">','<p class="centered"><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>','<span id="warntext" class="centered"></span>','</p>','</div>','<div id="multiplereserve" class="ui-state-error ui-corner-all" style="margin-top: 5px; padding: 0 .7em; width: 60%; margin-left: auto; margin-right: auto">','<p class="centered"><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>','<span class="centered">'+_("This animal already has an active reservation.")+'</span>','</p>','</div>','<div id="notonshelter" class="ui-state-error ui-corner-all" style="margin-top: 5px; padding: 0 .7em; width: 60%; margin-left: auto; margin-right: auto">','<p class="centered"><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>','<span class="centered">'+_("This animal is not on the shelter.")+'</span>','</p>','</div>','<table class="asm-table-layout">','<tr>','<td>','<label for="animal">'+_("Animal")+'</label>','</td>','<td>','<input id="animal" data="animal" type="hidden" class="asm-animalchooser" value=\'\' />','</td>','</tr>','<tr>','<td>','<label for="person">'+_("Reservation For")+'</label>','</td>','<td>','<input id="person" data="person" type="hidden" class="asm-personchooser" value=\'\' />','</td>','</tr>','<tr id="movementnumberrow">','<td><label for="movementnumber">'+_("Movement Number")+'</label></td>','<td><input id="movementnumber" data="movementnumber" class="asm-textbox" title=','"'+html.title(_("A unique number to identify this movement"))+'"',' /></td>','</tr>','<tr>','<td><label for="reservationdate">'+_("Date")+'</label></td>','<td>','<input id="reservationdate" data="reservationdate" class="asm-textbox asm-datebox" title="'+html.title(_("The date the reservation is effective from"))+'" />','</td>','</tr>','</table>',html.content_footer(),html.content_header(_("Donation"),true),'<table class="asm-table-layout">','<tr>','<td>','<label for="donationtype">'+_("Type")+'</label>','</td>','<td>','<select id="donationtype" data="donationtype" class="asm-selectbox">',html.list_to_options(controller.donationtypes,"ID","DONATIONNAME"),'</select>','</td>','</tr>','<tr>','<td>','<label for="payment">'+_("Payment Type")+'</label>','</td>','<td>','<select id="payment" data="payment" class="asm-selectbox">',html.list_to_options(controller.paymenttypes,"ID","PAYMENTNAME"),'</select>','</td>','</tr>','<tr>','<td>','<label for="amount">'+_("Amount")+'</label>','</td>','<td>','<input id="amount" data="amount" class="asm-currencybox asm-textbox" />','</td>','</tr>','<tr class="seconddonation">','<td>','<label for="donationtype2">'+_("Type")+'</label>','</td>','<td>','<select id="donationtype2" data="donationtype2" class="asm-selectbox">',html.list_to_options(controller.donationtypes,"ID","DONATIONNAME"),'</select>','</td>','</tr>','<tr class="seconddonation">','<td>','<label for="payment2">'+_("Payment Type")+'</label>','</td>','<td>','<select id="payment2" data="payment2" class="asm-selectbox">',html.list_to_options(controller.paymenttypes,"ID","PAYMENTNAME"),'</select>','</td>','</tr>','<tr class="seconddonation">','<td>','<label for="amount2">'+_("Amount")+'</label>','</td>','<td>','<input id="amount2" data="amount2" class="asm-currencybox asm-textbox" />','</td>','</tr>','<tr id="giftaidrow">','<td><label for="giftaid">'+_("Gift Aid")+'</label></td>','<td><select id="giftaid" data="giftaid" class="asm-selectbox">','<option value="0">'+_("Not eligible for gift aid")+'</option>','<option value="1">'+_("Eligible for gift aid")+'</option>','</select>','</td>','</tr>','</table>',html.content_footer(),html.box(5),'<button id="reserve">'+html.icon("movement")+' '+_("Reserve")+'</button>','</div>','</div>','<div id="page2">','<div class="ui-state-highlight ui-corner-all" style="margin-top: 5px; padding: 0 .7em;">','<p class="centered"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>','<span class="centered">'+_("Reservation successfully created."),'</span>','<span class="centered" id="reservefrom"></span>',html.icon("right"),'<span class="centered" id="reserveto"></span>','</p>','</div>','<div id="asm-reserve-accordion">','<h3><a href="#">'+_("Generate documentation")+'</a></h3>','<div id="templatelist">','</div>','</div>','</div>'].join("\n");},bind:function(){var validation=function(){header.hide_error();$("label").removeClass("ui-state-error-text");if($("#animal").val()==""){header.show_error(_("Movements require an animal"));$("label[for='animal']").addClass("ui-state-error-text");$("#animal").focus();return false;}
if($("#person").val()==""){header.show_error(_("This type of movement requires a person."));$("label[for='person']").addClass("ui-state-error-text");$("#person").focus();return false;}
if($.trim($("#reservationdate").val())==""){header.show_error(_("This type of movement requires a date."));$("label[for='reservationdate']").addClass("ui-state-error-text");$("#reservationdate").focus();return false;}
return true;};$("#animal").animalchooser().bind("animalchooserchange",function(event,rec){$("#notonshelter").fadeOut();$("#reserve").button("enable");if(rec.ARCHIVED=="1"&&rec.ACTIVEMOVEMENTTYPE!=2){$("#notonshelter").fadeIn();$("#reserve").button("disable");return;}
if(rec.HASACTIVERESERVE=="1"){$("#multiplereserve").fadeIn();}
var formdata="mode=templates&id="+rec.ID;common.ajax_post("move_reserve",formdata,function(data){$("#templatelist").html(data);});});$("#person").personchooser().bind("personchooserchange",function(event,rec){$("#giftaid").select("value",rec.ISGIFTAID);if(rec.ISBANNED==1&&config.bool("WarnBannedOwner")){$("#warntext").text(_("This person has been banned from adopting animals"));$("#ownerwarn").fadeIn();return;}
if(rec.INVESTIGATION>0){$("#warntext").html(_("This person has been under investigation"));$("#ownerwarn").fadeIn();return;}
if(rec.IDCHECK==0&&config.bool("WarnNoHomeCheck")){$("#warntext").text(_("This person has not passed a homecheck"));$("#ownerwarn").fadeIn();return;}
$("#ownerwarn").fadeOut();});var donationtype_change=function(){var dc=common.get_field(controller.donationtypes,$("#donationtype").select("value"),"DEFAULTCOST");$("#amount").currency("value",dc);};$("#donationtype").change(function(){donationtype_change();});var donationtype2_change=function(){var dc=common.get_field(controller.donationtypes,$("#donationtype2").select("value"),"DEFAULTCOST");$("#amount2").currency("value",dc);};$("#donationtype2").change(function(){donationtype2_change();});$("#ownerwarn").hide();$("#notonshelter").hide();$("#multiplereserve").hide();$("#movementnumberrow").hide();if(config.bool("MovementNumberOverride")){$("#movementnumberrow").show();}
if(asm.locale!="en_GB"){$("#giftaidrow").hide();}
$("#page1").show();$("#page2").hide();$("#asm-reserve-accordion").accordion({heightStyle:"content"});$("#donationtype").val(config.str("AFDefaultDonationType"));donationtype_change();$("#reservationdate").datepicker("setDate",new Date());if(config.bool("SecondDonationOnMove")){$(".seconddonation").show();$("#donationtype2").val($("#donationtype").val());$("#amount2").val($("#amount").val());}
else{$(".seconddonation").hide();}
$("#reserve").button().click(function(){if(!validation()){return;}
$("#reserve").button("disable");header.show_loading(_("Creating..."));var formdata=$("input, select").toPOST();common.ajax_post("move_reserve",formdata,function(data){$("#movementid").val(data);header.hide_loading();$("#reservefrom").html($(".animalchooser-display").html());$("#reserveto").html($(".personchooser-display .justlink").html());$("#page1").fadeOut(function(){$("#page2").fadeIn();});},function(){$("#reserve").button("enable");});});}};common.module(move_reserve,"move_reserve","newdata");});