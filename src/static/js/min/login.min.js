
$(function(){var login={render:function(){var h=['<div id="asm-login-nav" style="display: none">','<a href="mobile_login">'+_("Mobile")+'</a>','<img id="flag" />','</div>','<img id="qr" align="right" style="display: none" />','<div id="asm-login-window" class="dialogshadow" style="display: none">','<table width="100%" style="margin-left: auto; margin-right: auto; text-align: right; padding: 10px">','<tr class="asm-account-row hidden">','<td>','<label for="database">'+(controller.smcom?_("SM Account"):_("Database"))+'</label>','</td>','<td>','<input class="asm-textbox" id="database" name="database" type="text" />','</td>','</tr>','<tr>','<td>','<label for="username">'+_("Username")+'</label>','</td>','<td>','<input class="asm-textbox" id="username" name="username" type="text" />','</td>','</tr>','<tr>','<td>','<label for="password">'+_("Password")+'</label>','</td>','<td>','<input class="asm-textbox" id="password" name="password" type="password" />','</td>','</tr>','<tr>','<td>','</td>','<td>','<input class="asm-checkbox" id="rememberme" name="rememberme" type="checkbox" />','<label for="rememberme">'+_("Remember me on this computer")+'</label>','</td>','</tr>','</table>','<div class="centered" style="padding: 5px">','<button id="loginbutton" class="ui-priority-primary">'+_("Login")+'</button>','<img id="loginspinner" src="static/images/wait/wait16trans.gif" style="display: none" />','</div>','<div class="centered" style="margin-bottom: 5px">','<span id="forgottenpassword" style="display: none; margin-top: 5px"><a href="#">'+_("Forgotten password?")+'</a></span>','</div>','<div class="centered asm-login-fail" style="display: none">','<div class="ui-state-error ui-corner-all">','<p>','<span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>',_("Invalid username or password."),'</p>','</div>','</div>','<div class="centered asm-login-disabled" style="display: none">','<div class="ui-state-error ui-corner-all">','<p>','<span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>',_("Account disabled."),'</p>','</div>','</div>','<div class="centered asm-login-error" style="display: none">','<div class="ui-state-error ui-corner-all">','<p>','<span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>',_("Error contacting server."),'</p>','</div>','</div>','<div class="centered asm-login-tip" style="display: none">','<div class="ui-state-highlight ui-corner-all" style="margin-top: 20px; padding: 0 .7em">','<p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>',_("The default username is 'user' with the password 'letmein'"),'</p>','</div>','</div>'].join("\n");return h;},login:function(){$("#loginbutton").button("disable");$("#loginspinner").fadeIn();var username=$("input#username").val();var password=$("input#password").val();var database=$("input#database").val();var formdata={"database":database,"username":username,"password":password,"nologconnection":controller.nologconnection};$.ajax({type:"POST",url:"login",data:formdata,success:function(data){$("#loginspinner").fadeOut();if(String(data).indexOf("FAIL")!=-1){$(".asm-login-fail").fadeIn("slow").delay(3000).fadeOut("slow");$("input#username").focus();$("#loginbutton").button("enable");}
else if(String(data).indexOf("DISABLED")!=-1){$(".asm-login-disabled").fadeIn("slow").delay(3000).fadeOut("slow");$("input#username").focus();$("#loginbutton").button("enable");}
else{if($("#rememberme").prop("checked")){common.local_set("asmusername",username);common.local_set("asmpassword",password);common.local_set("asmaccount",database);}
else{common.local_delete("asmusername");common.local_delete("asmpassword");common.local_delete("asmaccount");}
$("#asm-login-window").fadeOut("slow",function(){if(controller.target==""){controller.target="main";}
window.location=controller.target;});}},error:function(){$("#loginspinner").fadeOut();$(".asm-login-error").fadeIn("slow").delay(3000).fadeOut("slow");$("input#username").focus();$("#loginbutton").button("enable");}});},bind:function(){var self=this;$("#asm-login-window").css({position:"absolute",left:($(window).width()-$("#asm-login-window").outerWidth())/2,top:($(window).height()-$("#asm-login-window").outerHeight())/2});if(controller.customsplash){if(controller.multipledatabases){$("#asm-login-window").css({"background-image":"url(login_splash?smaccount="+controller.smaccount+")"});}
else{$("#asm-login-window").css({"background-image":"url(login_splash)"});}}
else{var MAX_SPLASH=21;var splash=Math.floor(Math.random()*MAX_SPLASH);$("#asm-login-window").css({"background-image":"url(static/images/splash/splash"+splash+".jpg)"});}
$("#flag").attr("src","static/images/flags/"+controller.locale+".png").attr("title",controller.locale);if(controller.smcom){$("#qr").attr("src","static/images/ui/qr_m_sheltermanager_com.png");}
else{var qrurl=String(window.location);qrurl=qrurl.substring(0,qrurl.lastIndexOf("/"));qrurl+="/mobile_login";var qr="http://chart.apis.google.com/chart?";qr+="cht=qr&chl="+qrurl+"&chs=120x120";$("#qr").attr("src",qr).attr("alt","QR code for mobile devices").attr("title",qrurl);}
if(!controller.hasanimals){$(".asm-login-tip").fadeIn("slow");}
$("#asm-login-nav").delay(2000).slideDown("slow");$("#qr").delay(2500).fadeIn("slow");$("#asm-login-window").fadeIn("slow");if(controller.forgottenpassword){$("#forgottenpassword a").attr("href",controller.forgottenpassword);$("#forgottenpassword").show();}
if(controller.multipledatabases){$(".asm-account-row").show();$("input#database").focus();if(controller.smaccount!=""){$("#database").val(controller.smaccount);$("input#username").focus();}}
else{$(".asm-account-row").hide();$("input#username").focus();}
if(controller.husername!=""){$("input#username").val(controller.husername);}
if(controller.hpassword!=""){$("input#password").val(controller.hpassword);$("#loginbutton").button();self.login();}
if(common.local_get("asmusername")){$("#rememberme").prop("checked",true);$("input#username").val(common.local_get("asmusername"));$("input#password").val(common.local_get("asmpassword"));$("input#database").val(common.local_get("asmaccount"));}
$("#loginbutton").button().click(function(){self.login();});$("input#username").keypress(function(e){if(e.which==13){self.login();}});$("input#password").keypress(function(e){if(e.which==13){self.login();}});$("input#database").keypress(function(e){if(e.which==13){self.login();}});}};$("body").append(login.render());login.bind();});