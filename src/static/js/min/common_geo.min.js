
(function($){geo={get_lat_long:function(address,town,city,postcode,callback){if(asm.geoprovider=="nominatim"){this._nominatim_get_lat_long(address,town,city,postcode,callback);}
else if(asm.geoprovider=="google"){this._google_get_lat_long(address,town,city,postcode,callback);}},_google_get_lat_long:function(address,town,city,postcode,callback){var add=address+", "+town+", "+city+", "+postcode;window._goocallback=function(){var geocoder=new google.maps.Geocoder();geocoder.geocode({'address':add},function(results,status){if(status==google.maps.GeocoderStatus.OK){callback(results[0].geometry.location.lat(),results[0].geometry.location.lng());}
else{callback(0,0);}});};var key="";if(asm.geoproviderkey){key="&key="+asm.geoproviderkey;}
$.getScript("//maps.google.com/maps/api/js?v=3.x&sensor=false&async=2{key}&callback=_goocallback".replace("{key}",key));},_nominatim_get_lat_long:function(address,town,city,postcode,callback){var add=encodeURIComponent(address+", "+town).replace(/ /g,"+");$.getJSON("http://nominatim.openstreetmap.org/search?format=json&q="+add+"&json_callback=?",function(data){if(!data){callback(0,0);}
else{callback(data[0].lat,data[0].lon);}});},address_hash:function(address,town,city,postcode){var addrhash=address+town+city+postcode;addrhash=addrhash.replace(/ /g,'').replace(/,/g,'').replace(/\n/g,'');if(addrhash.length>220){addrhash=addrhash.substring(0,220);}
return addrhash;}};}(jQuery));